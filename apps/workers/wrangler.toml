name = "vannilli-api"
main = "apps/workers/src/index.ts"
compatibility_date = "2026-01-22"
node_compat = true

# Production environment
[env.production]
workers_dev = false
route = "api.vannilli.xaino.io/*"

# R2 Buckets
[[env.production.r2_buckets]]
binding = "RAW_UPLOADS"
bucket_name = "vannilli-raw-uploads"

[[env.production.r2_buckets]]
binding = "FINAL_RENDERS"
bucket_name = "vannilli-final-renders"

# D1 Database (for caching)
[[env.production.d1_databases]]
binding = "CACHE"
database_name = "vannilli-cache"
database_id = ""  # Fill in after creating D1 database

# Queues
[[env.production.queues.producers]]
binding = "VIDEO_QUEUE"
queue = "video-generation-queue"

# Environment variables
[env.production.vars]
ENVIRONMENT = "production"
SUPABASE_URL = ""  # Fill in with your Supabase URL
KLING_API_URL = "https://api.klingai.com/v1"

# Secrets (set via `wrangler secret put`)
# SUPABASE_SERVICE_KEY
# KLING_API_KEY
# STRIPE_SECRET_KEY
# STRIPE_WEBHOOK_SECRET
# SENTRY_DSN

# Preview environment
[env.preview]
workers_dev = true

[[env.preview.r2_buckets]]
binding = "RAW_UPLOADS"
bucket_name = "vannilli-raw-uploads-preview"

[[env.preview.r2_buckets]]
binding = "FINAL_RENDERS"
bucket_name = "vannilli-final-renders-preview"

[[env.preview.d1_databases]]
binding = "CACHE"
database_name = "vannilli-cache-preview"
database_id = ""

[[env.preview.queues.producers]]
binding = "VIDEO_QUEUE"
queue = "video-generation-queue-preview"

[env.preview.vars]
ENVIRONMENT = "preview"
SUPABASE_URL = ""
KLING_API_URL = "https://api.klingai.com/v1"

